Мета проєкту:
Створення консолідованого звіту для аналізу зв'язку між реєстраціями користувачів та їхньою активністю в імейл-кампаніях. Запит дозволяє виділити 10 ключових ринків (країн), що генерують найбільший обсяг трафіку та взаємодій.
Логіка роботи запиту (CTE Breakdown):
acc_metr (Агрегація акаунтів):
Збір даних про нові акаунти. Через ланцюжок джойнів (account -> session) визначається країна реєстрації та технічні атрибути (інтервал відправки, статус верифікації та відписки).
em_metr (Ефективність розсилок):
Розрахунок дати: Оскільки дата відправки зберігається як зміщення, використовується функція DATE_ADD для обчислення фактичного дня події.
Метрики: Підрахунок унікальних повідомлень за трьома етапами воронки: відправлено (sent), відкрито (open), перехід на сайт (visit).
data_all (Консолідація):
Об'єднання двох потоків даних через UNION ALL. Для збереження цілісності метрик у місцях пропусків підставляються нульові значення.
data_total (Глобальна агрегація):
Фінальне групування всіх показників за датою, країною та атрибутами акаунта. Це усуває будь-яке дублювання, що могло виникнути при об'єднанні таблиць.
data_country (Віконні функції):
Використання віконних функцій SUM(column) OVER (PARTITION BY country) для розрахунку загального обсягу (Total) по кожній країні за весь період без втрати денної деталізації.
data_send_interval & Final SELECT (Ранжування):
Застосування DENSE_RANK() для створення двох рейтингів. Фінальний результат фільтрує дані так, щоб залишити лише ті країни, які потрапили в Топ-10 або за кількістю акаунтів, або за кількістю відправлених листів.
Ключові технічні особливості:
Стійкість до Fan-out: Завдяки розділенню агрегації акаунтів та імейлів у різні СТЕ, запит уникає розмноження рядків при джойнах.
Гнучкість фільтрації: Рейтинг розраховується на основі сумарних значень, але у фінальному результаті зберігається можливість бачити щоденну динаміку.
Обробка часових зміщень: Коректна обробка sent_date дозволяє бачити реальну дату взаємодії користувача з листом.


# ЗАГОЛОВОК ПРОЄКТУ

---

## ІНСТРУМЕНТАРІЙ

*   SQL (BigQuery)

---

## МЕТА:

Консолідація щоденних метрик...

---

## БІЗНЕС-ПИТАННЯ:

Які країни генерують найбільше...
