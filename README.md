## МЕТА ПРОЄКТУ

СТВОРЕННЯ КОНСОЛІДОВАНОГО ЗВІТУ ДЛЯ АНАЛІЗУ ЗВ'ЯЗКУ МІЖ РЕЄСТРАЦІЯМИ КОРИСТУВАЧІВ ТА ЇХНЬОЮ АКТИВНІСТЮ В ІМЕЙЛ-КАМПАНІЯХ. ЗАПИТ ДОЗВОЛЯЄ ВИДІЛИТИ 10 КЛЮЧОВИХ РИНКІВ (КРАЇН), ЩО ГЕНЕРУЮТЬ НАЙБІЛЬШИЙ ОБСЯГ ТРАФІКУ ТА ВЗАЄМОДІЙ.

---

## ЛОГІКА РОБОТИ ЗАПИТУ (CTE BREAKDOWN)

*   **ACC_METR (АГРЕГАЦІЯ АКАУНТІВ):**
    ЗБІР ДАНИХ ПРО НОВІ АКАУНТИ. ЧЕРЕЗ ЛАНЦЮЖОК ДЖОЙНІВ (`ACCOUNT` -> `SESSION`) ВИЗНАЧАЄТЬСЯ КРАЇНА РЕЄСТРАЦІЇ ТА ТЕХНІЧНІ АТРИБУТИ (ІНТЕРВАЛ ВІДПРАВКИ, СТАТУС ВЕРИФІКАЦІЇ ТА ВІДПИСКИ).

*   **EM_METR (ЕФЕКТИВНІСТЬ РОЗСИЛОК):**
    РОЗРАХУНОК ДАТИ: ОСКІЛЬКИ ДАТА ВІДПРАВКИ ЗБЕРІГАЄТЬСЯ ЯК ЗМІЩЕННЯ, ВИКОРИСТОВУЄТЬСЯ ФУНКЦІЯ `DATE_ADD` ДЛЯ ОБЧИСЛЕННЯ ФАКТИЧНОГО ДНЯ ПОДІЇ.
    МЕТРИКИ: ПІДРАХУНОК УНІКАЛЬНИХ ПОВІДОМЛЕНЬ ЗА ТРЬОМА ЕТАПАМИ ВОРОНКИ: ВІДПРАВЛЕНО (`SENT`), ВІДКРИТО (`OPEN`), ПЕРЕХІД НА САЙТ (`VISIT`).

*   **DATA_ALL (КОНСОЛІДАЦІЯ):**
    ОБ'ЄДНАННЯ ДВОХ ПОТОКІВ ДАНИХ ЧЕРЕЗ `UNION ALL`. ДЛЯ ЗБЕРЕЖЕННЯ ЦІЛІСНОСТІ МЕТРИК У МІСЦЯХ ПРОПУСКІВ ПІДСТАВЛЯЮТЬСЯ НУЛЬОВІ ЗНАЧЕННЯ.

*   **DATA_TOTAL (ГЛОБАЛЬНА АГРЕГАЦІЯ):**
    ФІНАЛЬНЕ ГРУПУВАННЯ ВСІХ ПОКАЗНИКІВ ЗА ДАТОЮ, КРАЇНОЮ ТА АТРИБУТАМИ АКАУНТА. ЦЕ УСУВАЄ БУДЬ-ЯКЕ ДУБЛЮВАННЯ, ЩО МОГЛО ВИНИКНУТИ ПРИ ОБ'ЄДНАННІ ТАБЛИЦЬ.

*   **DATA_COUNTRY (ВІКОННІ ФУНКЦІЇ):**
    ВИКОРИСТАННЯ ВІКОННИХ ФУНКЦІЙ `SUM(COLUMN) OVER (PARTITION BY COUNTRY)` ДЛЯ РОЗРАХУНКУ ЗАГАЛЬНОГО ОБСЯГУ (TOTAL) ПО КОЖНІЙ КРАЇНІ ЗА ВЕСЬ ПЕРІОД БЕЗ ВТРАТИ ДЕННОЇ ДЕТАЛІЗАЦІЇ.

*   **DATA_SEND_INTERVAL & FINAL SELECT (РАНЖУВАННЯ):**
    ЗАСТОСУВАННЯ `DENSE_RANK()` ДЛЯ СТВОРЕННЯ ДВОХ РЕЙТИНГІВ. ФІНАЛЬНИЙ РЕЗУЛЬТАТ ФІЛЬТРУЄ ДАНІ ТАК, ЩОБ ЗАЛИШИТИ ЛИШЕ ТІ КРАЇНИ, ЯКІ ПОТРАПИЛИ В **ТОП-10** АБО ЗА КІЛЬКІСТЮ АКАУНТІВ, АБО ЗА КІЛЬКІСТЮ ВІДПРАВЛЕНИХ ЛИСТІВ.

---

## КЛЮЧОВІ ТЕХНІЧНІ ОСОБЛИВОСТІ

*   **СТІЙКІСТЬ ДО FAN-OUT:** ЗАВДЯКИ РОЗДІЛЕННЮ АГРЕГАЦІЇ АКАУНТІВ ТА ІМЕЙЛІВ У РІЗНІ СТЕ, ЗАПИТ УНИКАЄ РОЗМНОЖЕННЯ РЯДКІВ ПРИ ДЖОЙНАХ.
*   **ГНУЧКІСТЬ ФІЛЬТРАЦІЇ:** РЕЙТИНГ РОЗРАХОВУЄТЬСЯ НА ОСНОВІ СУМАРНИХ ЗНАЧЕНЬ, АЛЕ У ФІНАЛЬНОМУ РЕЗУЛЬТАТІ ЗБЕРІГАЄТЬСЯ МОЖЛИВІСТЬ БАЧИТИ ЩОДЕННУ ДИНАМІКУ.
*   **ОБРОБКА ЧАСОВИХ ЗМІЩЕНЬ:** КОРЕКТНА ОБРОБКА `SENT_DATE` ДОЗВОЛЯЄ БАЧИТИ РЕАЛЬНУ ДАТУ ВЗАЄМОДІЇ КОРИСТУВАЧА З ЛИСТОМ.

---

